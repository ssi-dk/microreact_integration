# README for the Microreact Integration package

## Functions in functions.py

These are the main functions meant for external use in functions.py:

- new_project
- get_project_json
- update_project

In order to use the functions, these prerequisites have to be fulfilled:

- A running instance of Microreact which can be accessed with http(s) from the location where Python is running
- An personal access token that will permit creation of projects in Microreact for a user

When a user is logged into Microreact, his/her access token will be visible at <https://MICROREACT_BASE:URL/my-account/settings>.
The calling system should have a stored copy of this token for each user.

### new_project

#### Arguments

Mandatory arguments:

- project_name: str
- tree_calcs: list
- metadata_keys: list
- metadata_values: list
- mr_access_token: str
- mr_base_url: str

Optional arguments:

- public: bool=False
- verify: bool=True

##### project_name

The name of the project as it will appear in Microreact. The project owner can later change the name from inside Microreact.

##### tree_calcs

A list of dicts (or dict-like objects like MongoDB documents) which represent the trees that should be exported to Microreact.

The dicts must contain these keys:

- method: str - this string will be used as name for the tree in Microreact
- result: str - this is the actual tree structure formatted in Newick format

##### metadata_keys

This is a list of str elements that will be used as column names in the data table in Microreact.

##### metadata_values

This should be a list of lists where each element in the outer list represents a column in the data table and the elements in each inner list
hold the actual data for that column.

##### mr_access_token

The access token for the users who will own the project in Microreact.

##### mr_base_url

The base URL for the Microreact instance.

##### public

Optional Booelan. If set to True, the created Microreact project will be public. Default is False.

##### verify

Optional Boolean. If set to False, it will not be checked if the Microreact instance has a valid SSL certificate. Default is True.

#### Return value

new_project will return a dict with the following keys:

- isOwner: wether the user is owner of the project (in fact always True)
- id: unique project id generated by Microreact
- url: project URL

## Command-line scripts

Although microreact_integration is primarily intended to use as a library for installing in other Python projects it has a few command-line scripts that can be used directly.

The scripts are intended for testing and demo purposes only.

All scripts take an optional --noverify argument. If this is provided the script will skip checking SSL certificate validity.

### Environment variables

These environment variables need to be set in order to use the commands:

- MICROREACT_BASE_URL: Base URL where Microreact is available
- MICROREACT_ACCESS_TOKEN: Personal access token for a Microreact user

### get_project_json.py

This script will print all information stored in MongoDB for an existing Microreact project owned by the Microreact user given by MICROREACT_ACCESS_TOKEN. It will NOT fetch any actual data values (like sequence ID's, metadata content, etc.) since Microreact
stores these on a filesystem that normally is unavailable for users. The information that get_project will fetch is data about the project structure and graphical layout.

usage:

    python get_project_json.py <project_id> <--noverify>

*project_id*: The unique ID which defines the project

Only projects that are owned by the Microreact user who owns MICROREACT_ACCESS_TOKEN can be fetched.

### new_project_from_files.py

This script will create a new project that will be owned by the user given by MICROREACT_ACCESS_TOKEN. The project will we a minimal project and will only contain a tree.

Usage:

    python new_project_from_files.py <tree> <metadata>

*tree*:  Path to a Newick file containing a tree to add
*metadata*: Path to a .tsv file containing data that will be shown in Microreacts data table (first column should contain the IDs)

### new_project_from_mongo.py

This script will create a new project that will be owned by the user given by MICROREACT_ACCESS_TOKEN. The project will we a minimal project and will only contain a tree.

Apart from the environment variables mentioned above, this script will also try to read the environment variable BIO_API_MONGO_CONNECTION.
This variable will be used as an URL for a MongoDB instance containing a tree calculation (created with Bio API). This MongoDB instance does not need
to be the same as the  one that exists in context with the Microreact instance.
If BIO_API_MONGO_CONNECTION is not set, the value will default to 'mongodb://mongodb:27017/bio_api_test'.

Usage:

    python new_project_from_mongo.py <--trees trees> <--project_name project_name>

*trees*: Mongo ID(s) for document(s) in the 'tree_calculation' collection in the MongoDB instance given by BIO_API_MONGO_CONNECTION. If more than one tree, separate the ID swith commas without spaces. If argument is omitted, a random document from the tree_calculations collection will be chosen.

*project_name*:  A name to use for the project created in Microreact

### add_tree

This script will add another tree to an existing project owned by the user given by MICROREACT_ACCESS_TOKEN.

Usage:

    python add_tree.py <project_id> <newick_file>

*project_id*: The unique ID that defines the project in Microreact
*newick_file*:  Path to a Newick file containing the tree to add
